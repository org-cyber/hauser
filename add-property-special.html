<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Add Property - Hauser NG</title>

<!-- TailwindCSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = { theme: { extend: { colors: { primary: "#0f172a", accent: "#f97316" } } } };
</script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

<style>
  body { background: linear-gradient(to bottom right, #0f172a, #1e293b); }
  .glass {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
</style>
</head>
<body class="text-white min-h-screen flex items-center justify-center p-6">

<div class="glass p-8 rounded-2xl shadow-xl w-full max-w-md space-y-6">
  <h1 class="text-2xl font-bold text-accent text-center">➕ Add Priority Property</h1>

  <form id="propertyForm" class="space-y-4">
    <input type="text" id="title" placeholder="Title" class="w-full p-2 rounded bg-white text-black" required>
    <input type="number" id="price" placeholder="Price (₦)" class="w-full p-2 rounded bg-white text-black" required>
    <input type="text" id="location" placeholder="Location" class="w-full p-2 rounded bg-white text-black" required>
    <textarea id="description" placeholder="Description" class="w-full p-2 rounded bg-white text-black"></textarea>
    <input type="text" id="createdBy" placeholder="Full Name (Who is Posting?)" class="w-full p-2 rounded bg-white text-black" required>
    <input type="tel" id="phoneNumber" placeholder="Phone Number" class="w-full p-2 rounded bg-white text-black" required>
    <input type="file" id="imageInput" accept="image/*" class="w-full p-2 rounded bg-white text-black" required>
    <button type="submit" class="bg-accent w-full py-2 rounded text-white font-bold hover:bg-orange-500">Add Priority Property</button>
  </form>

  <div id="status" class="text-center mt-2"></div>
  <div class="w-full bg-white h-2 rounded overflow-hidden mt-2">
    <div id="progressBar" class="bg-accent h-2" style="width:0%"></div>
  </div>

  <p class="text-center mt-2"><a href="agent.html" class="text-accent underline">← Back to Dashboard</a></p>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAHqg_u1DwWUB9l1vuoYDLKjCJl5Xx7Pbo",
    authDomain: "hauserng-77cc2.firebaseapp.com",
    projectId: "hauserng-77cc2",
    storageBucket: "hauserng-77cc2.appspot.com",
    messagingSenderId: "613578175402",
    appId: "1:613578175402:web:db7413f898987ac6a1f1d3"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged(user => {
    if (!user) {
      window.location.href = "login.html";
    }
  });

  const statusP = document.getElementById('status');
  const progressBar = document.getElementById('progressBar');

  document.getElementById('propertyForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    progressBar.style.width = "0%";
    statusP.textContent = "Starting image upload...";

    const file = document.getElementById('imageInput').files[0];
    const title = document.getElementById('title').value;
    const price = document.getElementById('price').value;
    const location = document.getElementById('location').value;
    const description = document.getElementById('description').value;
    const createdBy = document.getElementById('createdBy').value;
    const phoneNumber = document.getElementById('phoneNumber').value;
    const uid = auth.currentUser.uid;

    if (!file) {
      statusP.textContent = "Please pick an image.";
      return;
    }

    try {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', 'upload_preset');
      const cloudName = 'dfz7ghdbm';

      const xhr = new XMLHttpRequest();
      xhr.open('POST', `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`);

      xhr.upload.addEventListener('progress', (e) => {
        if (e.lengthComputable) {
          const percent = (e.loaded / e.total) * 100;
          progressBar.style.width = percent + "%";
          statusP.textContent = `Uploading image... (${Math.floor(percent)}%)`;
        }
      });

      xhr.addEventListener('load', async () => {
        const data = JSON.parse(xhr.responseText);
        if (xhr.status === 200 && data.secure_url) {
          statusP.textContent = "Saving property to Firestore...";
          progressBar.style.width = "100%";
          await db.collection('properties').add({
            uid,
            title,
            price,
            location,
            description,
            createdBy,
            phoneNumber,
            imageUrl: data.secure_url,
            priority: true,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          statusP.textContent = "✅ Priority property added successfully!";
          setTimeout(() => { window.location.href = 'agent.html'; }, 1500);
        } else {
          statusP.textContent = "❌ Error uploading image.";
          console.error(data);
        }
      });

      xhr.addEventListener('error', () => {
        statusP.textContent = "❌ Error uploading image.";
      });

      xhr.send(formData);
    } catch (error) {
      statusP.textContent = "❌ Error uploading image.";
      console.error(error);
    }
  });
</script>

</body>
</html>
<!-- Compare this snippet from login.html: -->